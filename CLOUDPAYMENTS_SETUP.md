# Настройка CloudPayments для ежемесячной подписки

## Шаг 1: Получение учетных данных

1. Зарегистрируйтесь в [личном кабинете CloudPayments](https://merchant.cloudpayments.ru/)
2. Получите ваш **Public ID** в разделе "Настройки" → "API"
3. Получите ваш **API Secret** (храните в секрете!)

## Шаг 2: Настройка переменных окружения

### Frontend (.env файл в папке frontend)
```env
VITE_CLOUDPAYMENTS_PUBLIC_ID=your_public_id_here
VITE_API_URL=http://localhost:3000
```

### Backend (.env файл в папке backend)
```env
CLOUDPAYMENTS_PUBLIC_ID=your_public_id_here
CLOUDPAYMENTS_API_SECRET=your_api_secret_here
```

## Шаг 3: Тестирование

### Тестовые карты CloudPayments:
- **Успешная оплата**: 4111 1111 1111 1111
- **Неуспешная оплата**: 4444 4444 4444 4444
- **Любая дата истечения** (в будущем)
- **Любой CVV** (3 цифры)

## Шаг 4: Проверка интеграции

1. Запустите backend: `cd backend && npm start`
2. Запустите frontend: `cd frontend && npm run dev`
3. Перейдите на страницу выбора плана
4. Нажмите "Оформить подписку"
5. Введите тестовые данные карты

## Особенности реализации

### Ежемесячная подписка
- **Интервал**: Month
- **Период**: 1 (раз в месяц)
- **Сумма**: 990 RUB
- **Валюта**: RUB
- **Автоматическое продление**: Да

### Чек для ФНС
Система автоматически формирует чек со следующими параметрами:
- **НДС**: 20%
- **Система налогообложения**: ОСН
- **Способ расчета**: Полная предварительная оплата

### Обработка ошибок
- Проверка доступности виджета
- Обработка ошибок платежа
- Логирование всех операций

## Безопасность

1. **API Secret** никогда не передается на frontend
2. Все платежные операции происходят через защищенный iframe
3. Данные карт не проходят через ваш сервер
4. Используется HTTPS для всех соединений

## Поддержка

При возникновении проблем:
1. Проверьте консоль браузера на ошибки
2. Убедитесь, что Public ID указан правильно
3. Проверьте, что скрипт CloudPayments загружен
4. Обратитесь к [документации CloudPayments](https://cloudpayments.ru/Docs/Api) 